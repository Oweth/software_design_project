<!DOCTYPE html>

<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Seller Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
  body {
    font-family: 'Inter', sans-serif;
    margin: 0;
    background-color: #FADAD8; /* Soft background */
    color: #231942; /* Primary text color */
  }

  .sidebar {
    width: 200px;
    background-color: #231942; /* Deep purple */
    color: white;
    height: 100vh;
    position: fixed;
    padding: 20px 0;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  .sidebar a {
    color: white;
    text-decoration: none;
    margin: 20px 0;
  }

  .main {
    margin-left: 200px;
    padding: 30px;
  }

  .dashboard-header {
    font-size: 24px;
    font-weight: 600;
    margin-bottom: 20px;
    color: #3B5249; /* Earthy green */
  }

  .stats-container {
    display: flex;
    gap: 20px;
    margin-bottom: 30px;
  }

  .card {
    background: #FADAD8; /* Peach */
    padding: 20px;
    border-radius: 8px;
    flex: 1;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
    border-left: 5px solid #AA6373; /* Rose accent */
  }

  section {
    margin-bottom: 40px;
  }

  section h2 {
    font-size: 20px;
    margin-bottom: 10px;
    color: #3B5249; /* Earthy green */
  }

  table {
    width: 100%;
    border-collapse: collapse;
    background: white;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
  }

  th, td {
    padding: 12px 16px;
    border-bottom: 1px solid #eee;
    text-align: left;
  }

  th {
    background-color: #93A8AC; /* Soft blue-gray */
    color: #231942; /* Deep purple text */
  }

  tr:last-child td {
    border-bottom: none;
  }

  img {
    border-radius: 4px;
  }
</style>

</head>
<body>

  <div class="sidebar">
    <a href="../index.html">Home</a>
    <a href="#" id="add-products-link">Add Products</a>
    <a>Analytics </a>
    <a href = "../html/deleteproduct.html">Delete Product</a>
    <a href = "../html/deletestore.html">Delete Store </a>

<a href="#">Logout</a>

  </div>

  <div class="main">
    <div id="headerid" class="dashboard-header">Welcome back, [Business Name]!</div>

<div class="stats-container">
  <div class=" card">
  <strong>Total Products</strong>
  <div id="total-products-count">0</div> <!-- ID added here -->
</div>

  
</div>
<h2>All Products</h2>

<table id="products-table">

  <thead>
    <tr>
      <th>Name</th>
      <th>Category</th>
      <th>Description</th>
      <th>Price</th>
      <th>Quantity</th>
      <th>Weight</th>
      <th>Image</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>




  </div>

  <!-- Firebase SDKs -->

  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>

  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>

  <!-- Your custom JavaScript file -->

  <script src="../scripts/seller_dashboard.js"></script>
<script type="module">
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
  import { collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
  import { auth, db } from "../lib/firebaseConfig.js"; // Adjust if needed

  // Button navigation
  document.getElementById("add-products-link")?.addEventListener("click", (e) => {
    e.preventDefault();
    window.location.href = "../html/add_product.html";
  });

 function loadTable(collectionName, tableSelector, mapRow, userId = null) {
  let q = collection(db, collectionName);
  if (userId) {
    q = query(q, where("userId", "==", userId));
  }

  getDocs(q).then(snapshot => {
    const tbody = document.querySelector(`${tableSelector} tbody`);
    if (!tbody) {
      console.error(`Table body not found for selector: ${tableSelector}`);
      return;
    }

    tbody.innerHTML = "";

    let totalQuantity = 0;

    snapshot.forEach(doc => {
      const d = doc.data();
      totalQuantity += Number(d.quantity || 0); // sum up product quantities
      tbody.innerHTML += mapRow(d);
    });

    // Update total products box
    const totalProductsBox = document.getElementById("total-products-count");
    if (totalProductsBox) {
      totalProductsBox.textContent = totalQuantity;
    }
  }).catch(error => {
    console.error(`Error loading ${collectionName}:`, error);
  });
}


  // Auth listener
  onAuthStateChanged(auth, async (user) => {
    if (user) {
      const uid = user.uid;

      // Load business name
      const sellerQuery = query(collection(db, "sellers"), where("userId", "==", uid));
      const sellerSnap = await getDocs(sellerQuery);
      if (!sellerSnap.empty) {
        const sellerData = sellerSnap.docs[0].data();
        const businessName = sellerData.businessName || "Seller";
        const header = document.getElementById("headerid");
        if (header) {
          header.textContent = `Welcome back, ${businessName}!`;
        }
      }

      // Load products
      loadTable("products", "#products-table", (d) => `
        <tr>
          <td>${d.name}</td>
          <td>${d.category}</td>
          <td>${d.description}</td>
          <td>$${d.price}</td>
          <td>${d.quantity}</td>
          <td>${d.weight}</td>
          <td><img src="${d.imageUrl}" width="50"/></td>
        </tr>
      `, uid);
    } else {
      console.warn("User not signed in.");
    }
  });
</script>



</body>
</html>
